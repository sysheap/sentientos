#!/usr/bin/env bash
set -e

# Format only staged Rust files to avoid touching unstaged work
staged_rs_files=$(git diff --name-only --cached --diff-filter=d -- '*.rs')
if [ -n "$staged_rs_files" ]; then
    echo "$staged_rs_files" | xargs rustfmt
    echo "$staged_rs_files" | xargs git add
fi

# Run tests â€” commit is blocked if any test fails
just test
